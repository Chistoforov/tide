# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å cron-–∑–∞–¥–∞—á–∞–º–∏

## –ü—Ä–æ–±–ª–µ–º–∞: Cron-–∑–∞–¥–∞—á–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

–ï—Å–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

## –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ vercel.json –∑–∞–¥–µ–ø–ª–æ–µ–Ω

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `vercel.json` –∑–∞–∫–æ–º–º–∏—á–µ–Ω –∏ –∑–∞–ø—É—à–µ–Ω:
   ```bash
   git status
   git add vercel.json
   git commit -m "Add cron configuration"
   git push
   ```

2. –ü–æ—Å–ª–µ –ø—É—à–∞ —Å–¥–µ–ª–∞–π—Ç–µ –Ω–æ–≤—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ Vercel (–∏–ª–∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è)

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron-–∑–∞–¥–∞—á–∏ –≤ Vercel Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Vercel Dashboard](https://vercel.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Cron Jobs**
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - ‚úÖ –ï—Å—Ç—å –ª–∏ 4 –∑–∞–¥–∞—á–∏ (00:00, 06:00, 12:00, 18:00 UTC)
   - ‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á (–∞–∫—Ç–∏–≤–Ω—ã –ª–∏ –æ–Ω–∏)
   - ‚úÖ –ò—Å—Ç–æ—Ä–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å)

**–ï—Å–ª–∏ –∑–∞–¥–∞—á –Ω–µ—Ç:**
- –°–æ–∑–¥–∞–π—Ç–µ –∏—Ö –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ UI (—Å–º. –Ω–∏–∂–µ)
- –ò–ª–∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `vercel.json` –ø—Ä–∏–º–µ–Ω–µ–Ω –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

**–ï—Å–ª–∏ –∑–∞–¥–∞—á–∏ –µ—Å—Ç—å, –Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∑–∞–¥–∞—á—É)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ endpoint –¥–æ—Å—Ç—É–ø–µ–Ω (–®–∞–≥ 3)

## –®–∞–≥ 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ endpoint –≤—Ä—É—á–Ω—É—é

### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –£–∑–Ω–∞–π—Ç–µ URL –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Vercel (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://tide-tracker.vercel.app`)

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:
   ```bash
   npm run test-update https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app
   ```

3. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `CRON_SECRET`, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `.env.local`:
   ```bash
   echo $CRON_SECRET
   ```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ curl

```bash
# –ë–µ–∑ —Å–µ–∫—Ä–µ—Ç–∞ (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
curl "https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app/api/tide/update"

# –° —Å–µ–∫—Ä–µ—Ç–æ–º (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
curl "https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app/api/tide/update?secret=–í–ê–®_–°–ï–ö–†–ï–¢"
```

### –í–∞—Ä–∏–∞–Ω—Ç C: –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app/api/tide/update?secret=–í–ê–®_–°–ï–ö–†–ï–¢
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "Tide data saved to database successfully",
  "fetchedAt": "2024-01-01T12:00:00.000Z"
}
```

## –®–∞–≥ 4: –ï—Å–ª–∏ endpoint –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel:
1. Vercel Dashboard ‚Üí **Functions** ‚Üí `/api/tide/update`
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–∑–æ–≤—ã –∏ –æ—à–∏–±–∫–∏

**–ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏:**
- `STORMGLASS_API_KEY is not configured` ‚Üí –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel
- `Unauthorized` ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `CRON_SECRET` –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `x-vercel-cron`
- –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `NEXT_PUBLIC_SUPABASE_URL` –∏ `SUPABASE_SERVICE_ROLE_KEY`

## –®–∞–≥ 5: –°–æ–∑–¥–∞–π—Ç–µ cron-–∑–∞–¥–∞—á–∏ –≤—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–µ —Å–æ–∑–¥–∞–ª–∏—Å—å)

1. Vercel Dashboard ‚Üí **Settings** ‚Üí **Cron Jobs**
2. –ù–∞–∂–º–∏—Ç–µ **Add Cron Job**
3. –°–æ–∑–¥–∞–π—Ç–µ 4 –∑–∞–¥–∞—á–∏:

   **–ó–∞–¥–∞—á–∞ 1:**
   - Path: `/api/tide/update`
   - Schedule: `0 0 * * *`
   
   **–ó–∞–¥–∞—á–∞ 2:**
   - Path: `/api/tide/update`
   - Schedule: `0 6 * * *`
   
   **–ó–∞–¥–∞—á–∞ 3:**
   - Path: `/api/tide/update`
   - Schedule: `0 12 * * *`
   
   **–ó–∞–¥–∞—á–∞ 4:**
   - Path: `/api/tide/update`
   - Schedule: `0 18 * * *`

## –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
1. Vercel Dashboard ‚Üí **Settings** ‚Üí **Environment Variables**
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ:
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `SUPABASE_SERVICE_ROLE_KEY`
   - `STORMGLASS_API_KEY`
   - `BEACH_LATITUDE` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - `BEACH_LONGITUDE` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - `CRON_SECRET` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è **Production** –æ–∫—Ä—É–∂–µ–Ω–∏—è

## –®–∞–≥ 7: –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. –í—ã–∑–æ–≤–∏—Ç–µ endpoint –≤—Ä—É—á–Ω—É—é –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: `npm run check-db`
3. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è cron (00:00, 06:00, 12:00, 18:00 UTC)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ Vercel Dashboard

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å –¥–ª—è cron

–ï—Å–ª–∏ cron-–∑–∞–¥–∞—á–∏ –≤ Vercel –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å:

### cron-job.org (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [cron-job.org](https://cron-job.org)
2. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É:
   - URL: `https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app/api/tide/update?secret=–í–ê–®_–°–ï–ö–†–ï–¢`
   - Schedule: `0 0,6,12,18 * * *` (4 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å)
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∑–∞–¥–∞—á—É

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
npm run check-db

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ endpoint (–Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å URL)
npm run test-update https://–≤–∞—à-–¥–æ–º–µ–Ω.vercel.app

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ª–æ–∫–∞–ª—å–Ω–æ)
cat .env.local | grep -E "(SUPABASE|STORMGLASS|CRON)"
```




